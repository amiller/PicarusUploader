<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <title>Hello World</title>
    </head>
    <body>
        <div class="app">
            <h1>Apache Cordova</h1>
            <div id="deviceready" class="blink">
                <p class="event listening">Connecting to Device</p>
                <p class="event received">Device is Ready</p>
            </div>
        </div>
        <script type="text/javascript" src="cordova-2.1.0.js"></script>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>
	<script>
function b64toBlob(b64) {
    var byteString = atob(b64);
    var mimeString = "image/jpeg";
    
    // write the bytes of the string to an ArrayBuffer
    var ab = new ArrayBuffer(byteString.length);
    var ia = new Uint8Array(ab);
    for (var i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
    }

    // write the ArrayBuffer to a blob, and you're done
    return new Blob([ab], "image/jpeg");
}

function upload1(fileURI, win, fail) {
   var options = new FileUploadOptions();
   options.fileKey="image";
   //options.fileName=fileURI.substr(fileURI.lastIndexOf('/')+1);
   options.fileName = "blah.jpg";
   options.mimeType="image/jpeg";
   options.chunkedMode = false;
   
   var params = new Object();
   options.params = params;

   var ft = new FileTransfer();
   ft.upload(fileURI, "https://api.picar.us/see/faces", win, fail, options, false);
}

function takePicture() {
   navigator.camera.getPicture(
      function (imageURI) {
			      upload1(imageURI,
			function(r) {
			 console.log("Code = " + r.responseCode);
             console.log("Response = " + r.response);
             console.log("Sent = " + r.bytesSent);
             alert(r.response)
            },
			function(r) {console.log('error' + r.code);}
			      );
      }, function (message) { 
         alert('camera error: ' + message); 
      }, 
      {destinationType : Camera.DestinationType.FILE_URI,
       encodingType: Camera.EncodingType.JPEG,}
   );
}

function upload2() {
        imageData = "iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==";
          data = new FormData();
          data.append( 'image', b64toBlob(imageData) );
          $.ajax({
			 url:"https://api.picar.us/see/faces",
			 type:"post",
			 contentType: false,
             processData: false,
			 data:data,
			 success:function(data, message) {
			     alert('success' + message);
			 },
			 error:function(data, message) {
			     alert('error' + message);
			 },
          });
}
</script>

<input type="button" style="width:200px; height:400px" onClick="takePicture();"/>
</html>
